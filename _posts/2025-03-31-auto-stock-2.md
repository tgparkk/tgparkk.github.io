---
layout: post
title: "í•œêµ­íˆ¬ìì¦ê¶Œ APIë¡œ ìë™ ë§¤ë§¤ ì‹œìŠ¤í…œ ê°œë°œí•˜ê¸° â€“ 2: ê³ ë„í™”ì™€ ê¸°ëŠ¥ í™•ì¥"
date: 2025-03-31
categories: stock
tags: [stock, python, ml]
excerpt: "ì¬í…Œí¬ í•˜ê³  ì‹¶ì–´ìš”.."
comments: true
---

# í•œêµ­íˆ¬ìì¦ê¶Œ APIë¡œ ìë™ ë§¤ë§¤ ì‹œìŠ¤í…œ ê°œë°œí•˜ê¸° â€“ 2: ê³ ë„í™”ì™€ ê¸°ëŠ¥ í™•ì¥

ì•ˆë…•í•˜ì„¸ìš”! ì§€ë‚œ í¬ìŠ¤íŠ¸ì—ì„œ í•œêµ­íˆ¬ìì¦ê¶Œ APIë¥¼ í™œìš©í•œ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œì˜ ê¸°ì´ˆ í™˜ê²½ êµ¬ì¶•ê³¼ ì¸ì¦ ëª¨ë“ˆ ê°œë°œì— ëŒ€í•´ ë‹¤ë¤˜ìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ì‹œìŠ¤í…œ ê³ ë„í™” ê³¼ì •ì—ì„œ ê²½í—˜í•œ ì„¸ ê°€ì§€ ì¤‘ìš”í•œ ë°œì „ ì‚¬í•­ì„ ê³µìœ í•˜ê³ ì í•©ë‹ˆë‹¤.

## ë¡œê¹… ì‹œìŠ¤í…œ ê°•í™”: ì„±ëŠ¥ ê°œì„ ê³¼ ë””ë²„ê¹…ì˜ í•µì‹¬

ì²˜ìŒ ì‹œìŠ¤í…œì„ ìš´ì˜í•˜ë©´ì„œ ê°€ì¥ ë¨¼ì € ë¶€ë”ªíŒ ë¬¸ì œëŠ” 'ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚¬ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ë‹¤'ëŠ” ì ì´ì—ˆìŠµë‹ˆë‹¤. ê¸°ë³¸ì ì¸ ë¡œê¹…ë§Œìœ¼ë¡œëŠ” ë§¤ë§¤ ì‹¤íŒ¨ì˜ ì›ì¸ì„ íŒŒì•…í•˜ê¸° ì–´ë ¤ì› ê³ , ì‹œìŠ¤í…œì˜ ë™ì‘ë“¤ì— ëŒ€í•´ ëª…í™•í•œ ì´ìœ ë¥¼ ì•Œ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.

### ë¬¸ì œ ìƒí™©

- API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ì›ì¸ íŒŒì•… ì–´ë ¤ì›€
- ë§¤ë§¤ ì˜ì‚¬ê²°ì • ê³¼ì • ì¶”ì  ë¶ˆê°€ëŠ¥
- ì‹œìŠ¤í…œ ì¥ê¸° ìš´ì˜ ì‹œ ë¡œê·¸ íŒŒì¼ ê´€ë¦¬ ë¬¸ì œ

### ê°œì„  ì‚¬í•­

#### 1. ê³„ì¸µí˜• ë¡œê¹… êµ¬ì¡° ë„ì…

```python
def setup_logger(log_file=None, log_level=logging.DEBUG):
    """í–¥ìƒëœ ë¡œê¹… ì„¤ì • í•¨ìˆ˜"""
    # ë£¨íŠ¸ ë¡œê±° ì„¤ì •
    logger = logging.getLogger()
    logger.setLevel(log_level)
    
    # í¬ë§· ì„¤ì • - ë” ìì„¸í•œ ì •ë³´ í¬í•¨
    formatter = logging.Formatter(
        '[%(asctime)s] %(levelname)s [%(name)s.%(funcName)s:%(lineno)d] %(message)s',
        datefmt='%Y-%m-%d %H:%M:%S'
    )
    
    # ë¡œí…Œì´íŒ… íŒŒì¼ í•¸ë“¤ëŸ¬ ì¶”ê°€ - ì¼ë³„ ë¡œê·¸ íŒŒì¼ ìƒì„±
    if log_file:
        from logging.handlers import TimedRotatingFileHandler
        file_handler = TimedRotatingFileHandler(
            log_file,
            when='midnight',
            interval=1,
            backupCount=30  # 30ì¼ì¹˜ ë¡œê·¸ ìœ ì§€
        )
        file_handler.setFormatter(formatter)
        file_handler.setLevel(logging.DEBUG)  # íŒŒì¼ì—ëŠ” ìƒì„¸ ë¡œê·¸
        logger.addHandler(file_handler)
    
    # ì½˜ì†” í•¸ë“¤ëŸ¬ëŠ” ì¤‘ìš” ì •ë³´ë§Œ í‘œì‹œ
    console_handler = logging.StreamHandler()
    console_handler.setFormatter(formatter)
    console_handler.setLevel(logging.INFO)  # ì½˜ì†”ì—ëŠ” ì£¼ìš” ì •ë³´ë§Œ
    logger.addHandler(console_handler)
    
    return logger
```

#### 2. ì˜ì‚¬ê²°ì • ë¡œê¹… ì¶”ê°€

ê±°ë˜ ì‹ í˜¸ ìƒì„± ì‹œ ëª…í™•í•œ ì´ìœ ë¥¼ ë¡œê¹…í•˜ë„ë¡ ê°œì„ í–ˆìŠµë‹ˆë‹¤:

```python
def analyze_intraday_stock(self, stock_code):
    """ì¼ì¤‘ ë°ì´í„° ê¸°ë°˜ ì¢…ëª© ë¶„ì„"""
    # ... ê¸°ì¡´ ì½”ë“œ ...
    
    # 5. ë§¤ë§¤ ì‹ í˜¸ ìƒì„±
    signal = 'neutral'
    reasons = []
    
    # ë§¤ìˆ˜ ì¡°ê±´
    if (price_change > 0.002 and volume_increase > 1.1):
        signal = 'buy'
        reasons.append(f'ìƒìŠ¹ ì¶”ì„¸ ê°ì§€ ({price_change:.1%})')
        reasons.append(f'ê±°ë˜ëŸ‰ ì¦ê°€ (í‰ê·  ëŒ€ë¹„ {volume_increase:.1f}ë°°)')
    elif bb_lower is not None and price < bb_lower * 1.02:
        signal = 'buy'
        reasons.append(f'ë³¼ë¦°ì € ë°´ë“œ í•˜ë‹¨ ì§€ì§€ (ê°€ê²©: {price:.1f}, ë°´ë“œí•˜ë‹¨: {bb_lower:.1f})')
    
    # ... ì¶”ê°€ ì¡°ê±´ ...
    
    # ìƒì„¸ ë¡œê¹…
    if signal != 'neutral':
        self.logger.info(f"[ë§¤ë§¤ ë¶„ì„] {stock_code} ì‹ í˜¸: {signal}, ì´ìœ : {', '.join(reasons)}")
    else:
        self.logger.debug(f"[ë§¤ë§¤ ë¶„ì„] {stock_code} - ì¤‘ë¦½ ì‹ í˜¸")
    
    return {
        'signal': signal, 
        'reasons': reasons,
        # ... ê¸°íƒ€ ë°˜í™˜ ë°ì´í„° ...
    }
```

#### 3. API ì‘ë‹µ ìƒì„¸ ë¡œê¹…

API í˜¸ì¶œ ì˜¤ë¥˜ ì‹œ ë” ìì„¸í•œ ì •ë³´ë¥¼ ë¡œê¹…í•˜ë„ë¡ ê°œì„ í–ˆìŠµë‹ˆë‹¤:

```python
def get_stock_current_price(self, stock_code):
    """íŠ¹ì • ì¢…ëª©ì˜ í˜„ì¬ê°€ ì¡°íšŒ"""
    try:
        # ... API í˜¸ì¶œ ì½”ë“œ ...
        
        response = requests.get(url, params=params, headers=headers)
        
        # ìƒì„¸ ì‘ë‹µ ë¡œê¹…
        if response.status_code != 200:
            logger.error(f"API ì˜¤ë¥˜ ({response.status_code}): {url}")
            logger.error(f"ìš”ì²­ íŒŒë¼ë¯¸í„°: {params}")
            logger.error(f"ì‘ë‹µ ë‚´ìš©: {response.text}")
        
        response.raise_for_status()
        
        # ... ê¸°ì¡´ ì½”ë“œ ...
        
    except Exception as e:
        logger.error(f"í˜„ì¬ê°€ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜: {str(e)}, ì¢…ëª©ì½”ë“œ: {stock_code}")
        if 'response' in locals():
            logger.error(f"ì‘ë‹µ ìƒíƒœ: {response.status_code}")
            logger.error(f"ì‘ë‹µ í—¤ë”: {response.headers}")
            logger.error(f"ì‘ë‹µ ë‚´ìš©: {response.text[:500]}")  # ì²« 500ìë§Œ ë¡œê¹…
        raise
```

í–¥ìƒëœ ë¡œê¹… ì‹œìŠ¤í…œ ë•ë¶„ì— ì‹œìŠ¤í…œì˜ íˆ¬ëª…ì„±ì´ í¬ê²Œ í–¥ìƒë˜ì—ˆê³ , ë§¤ë§¤ ê²°ì •ì— ëŒ€í•œ ê·¼ê±°ë¥¼ ëª…í™•íˆ íŒŒì•…í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ ì‹¤íŒ¨í•œ ê±°ë˜ì˜ ì›ì¸ì„ ì •í™•íˆ ì¶”ì í•  ìˆ˜ ìˆê²Œ ë˜ì–´ ì‹œìŠ¤í…œ ê°œì„ ì— í° ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.

## ë‹¨ê¸° ë§¤ë§¤ ì „ëµ ë„ì…: ì¼ì¤‘ ë³€ë™ì„± í™œìš©í•˜ê¸°

ê¸°ì¡´ ì‹œìŠ¤í…œì€ ì¼ê°„ ì£¼ê°€ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ê¸°ë³¸ ì „ëµë§Œ êµ¬í˜„ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì¥ì¤‘ ê°€ê²© ë³€ë™ì„ í™œìš©í•˜ì—¬ ë” ë¹ ë¥¸ ë§¤ë§¤ ê¸°íšŒë¥¼ í¬ì°©í•˜ê³ ì ë‹¨ê¸° ë§¤ë§¤ ì „ëµì„ ë„ì…í–ˆìŠµë‹ˆë‹¤.

### ë¬¸ì œ ìƒí™©

- ì¼ê°„ ë°ì´í„°ë§Œìœ¼ë¡œëŠ” ì¥ì¤‘ ë³€ë™ì„± í™œìš© ë¶ˆê°€
- ë¹ ë¥¸ ë§¤ë§¤ ì‹ í˜¸ì— ëŒ€ì‘í•˜ì§€ ëª»í•¨
- ê°‘ì‘ìŠ¤ëŸ¬ìš´ ì‹œì¥ ë³€ë™ì— ëŒ€ì‘ ì–´ë ¤ì›€

### ê°œì„  ì‚¬í•­

#### 1. DayTradingStrategy í´ë˜ìŠ¤ êµ¬í˜„

ì¼ê°„ íŠ¸ë ˆì´ë”©ì— íŠ¹í™”ëœ ì „ëµ í´ë˜ìŠ¤ë¥¼ ìƒˆë¡œ ê°œë°œí–ˆìŠµë‹ˆë‹¤:

```python
class DayTradingStrategy(BasicStrategy):
    """ì¼ì¼ íŠ¸ë ˆì´ë”©(Day Trading) ì „ëµ í´ë˜ìŠ¤"""
    
    def __init__(self, market_data, order_api, config=None):
        super().__init__(market_data, order_api, config)
        
        # ì¼ì¼ íŠ¸ë ˆì´ë”© ì¶”ê°€ ì„¤ì •ê°’
        self.day_trading_config = {
            'entry_time_start': '09:30',  # ì§„ì… ì‹œì‘ ì‹œê°„
            'entry_time_end': '14:00',    # ì§„ì… ì¢…ë£Œ ì‹œê°„
            'exit_time': '15:00',         # ì²­ì‚° ì‹œê°„
            'min_volume_increase': 1.5,   # ìµœì†Œ ê±°ë˜ëŸ‰ ì¦ê°€ìœ¨
            'profit_target': 0.01,        # 1% ëª©í‘œ ìˆ˜ìµë¥  
            'stop_loss': 0.005,           # 0.5% ì†ì ˆ
            'max_positions': 5,           # ìµœëŒ€ í¬ì§€ì…˜ ê°œìˆ˜
        }
```

#### 2. ì¥ì¤‘ ë°ì´í„° ë¶„ì„ ê¸°ëŠ¥ ì¶”ê°€

ê¸°ì¡´ ì¼ê°„ ë°ì´í„° ìœ„ì£¼ì˜ ë¶„ì„ì—ì„œ ì¥ì¤‘ ë°ì´í„°ë¥¼ í™œìš©í•œ ë¶„ì„ ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤:

```python
def analyze_intraday_stock(self, stock_code):
    """ì¼ì¤‘ ë°ì´í„° ê¸°ë°˜ ì¢…ëª© ë¶„ì„"""
    try:
        # 1. í˜„ì¬ê°€ ë°ì´í„° ì¡°íšŒ
        current_data = self.market_data.get_stock_current_price(stock_code)
        
        # 2. ê°€ê²© ë³€ë™ì„± ì²´í¬
        price = float(current_data.get('stck_prpr', 0))
        prev_price = float(current_data.get('stck_sdpr', 0))  # ì „ì¼ ì¢…ê°€
        price_change = (price - prev_price) / prev_price
        
        # 3. ê±°ë˜ëŸ‰ í™•ì¸
        volume = int(current_data.get('acml_vol', 0))
        prev_day_volume = int(current_data.get('prdy_vol', 0))
        
        # ê±°ë˜ ì‹œê°„ ê²½ê³¼ìœ¨ ê³„ì‚° (ì¥ ì‹œì‘ í›„ ê²½ê³¼ ì‹œê°„ / ì´ ê±°ë˜ ì‹œê°„)
        now = datetime.now()
        market_open = now.replace(hour=9, minute=0, second=0)
        market_close = now.replace(hour=15, minute=30, second=0)
        total_trading_minutes = (market_close - market_open).total_seconds() / 60
        elapsed_minutes = (now - market_open).total_seconds() / 60
        trading_hours_passed = min(1.0, max(0.1, elapsed_minutes / total_trading_minutes))
        
        # ì˜ˆìƒ ì¢…ì¼ ê±°ë˜ëŸ‰ ëŒ€ë¹„ í˜„ì¬ ê±°ë˜ëŸ‰
        volume_increase = volume / (prev_day_volume * trading_hours_passed)
                
        # 4. ë³¼ë¦°ì € ë°´ë“œ ê³„ì‚°
        df = self.market_data.get_stock_daily_price(stock_code, period=20)
        
        # ... ê¸°ìˆ ì  ë¶„ì„ ê³„ì‚° ...
        
        # 5. ë§¤ë§¤ ì‹ í˜¸ ìƒì„±
        # ... ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼ ...
        
        return {
            'signal': signal, 
            'reasons': reasons,
            'price': price,
            'price_change': price_change,
            'volume_increase': volume_increase,
        }
    
    except Exception as e:
        logger.error(f"ì¼ì¤‘ ì¢…ëª© ë¶„ì„ ì˜¤ë¥˜ ({stock_code}): {str(e)}")
        return {'signal': 'error', 'reason': str(e)}
```

#### 3. ë§¤ë§¤ ì‹œê°„ ì œì•½ êµ¬í˜„

ë§¤ë§¤ ì‹œê°„ëŒ€ë¥¼ ì œí•œí•˜ì—¬ ì¥ ì´ˆë°˜ì˜ ë³€ë™ì„±ì„ í”¼í•˜ê³  ì•ˆì •ì ì¸ íŠ¸ë ˆì´ë”©ì´ ê°€ëŠ¥í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤:

```python
def is_entry_time(self):
    """ì§„ì… ê°€ëŠ¥ ì‹œê°„ì¸ì§€ í™•ì¸"""
    now = datetime.now()
    current_time = now.strftime('%H:%M')
    return self.day_trading_config['entry_time_start'] <= current_time <= self.day_trading_config['entry_time_end']

def is_exit_time(self):
    """ì²­ì‚° ì‹œê°„ì¸ì§€ í™•ì¸"""
    now = datetime.now()
    current_time = now.strftime('%H:%M')
    return current_time >= self.day_trading_config['exit_time']

def run(self, target_stocks):
    """ì „ëµ ì‹¤í–‰"""
    # ... ê¸°ì¡´ ì½”ë“œ ...
    
    # ì¥ ë§ˆê° ì „ì´ë©´ ëª¨ë“  í¬ì§€ì…˜ ì²­ì‚°
    if self.is_exit_time():
        logger.info("ì¥ ë§ˆê° ì „ ì²­ì‚° ì‹œê°„")
        
        for stock_code in list(self.positions.keys()):
            logger.info(f"ì¥ ë§ˆê° ì „ ì²­ì‚°: {stock_code}")
            result = self.execute_sell(stock_code)
            
            if result:
                results['sells'].append({
                    'stock_code': stock_code,
                    'reason': 'ì¥ ë§ˆê° ì „ ì²­ì‚°',
                    'result': result
                })
        
        return results
    
    # ì§„ì… ê°€ëŠ¥ ì‹œê°„ì´ ì•„ë‹ˆë©´ ë§¤ìˆ˜ ì•ˆ í•¨
    if not self.is_entry_time():
        logger.info("ì§„ì… ê°€ëŠ¥ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤")
        
        # ê¸°ì¡´ í¬ì§€ì…˜ ì ê²€ë§Œ ìˆ˜í–‰
        for stock_code in list(self.positions.keys()):
            should_sell, reason = self.should_sell(stock_code)
            
            if should_sell:
                # ... ë§¤ë„ ë¡œì§ ...
        
        return results
    
    # ... ë§¤ìˆ˜ ë¡œì§ ...
```

ë‹¨ê¸° ë§¤ë§¤ ì „ëµ ë„ì… ê²°ê³¼, ì¥ì¤‘ ë¹ ë¥¸ ê°€ê²© ë³€ë™ì— ëŒ€ì‘í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆê³ , ê±°ë˜ ë¹ˆë„ê°€ ì¦ê°€í•˜ë©´ì„œ ìˆ˜ìµ ê¸°íšŒë„ ëŠ˜ì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ ì¥ ë§ˆê° ì „ ìë™ ì²­ì‚° ê¸°ëŠ¥ì€ ì˜¤ë²„ë‚˜ì‡ ë¦¬ìŠ¤í¬ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì œê±°í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.
(í•˜ì§€ë§Œ... ì•„ì§ ë§¤ìˆ˜ë¥¼ ì•ˆí•˜ê³  ìˆë„¤ìš”...)

## ë¨¸ì‹ ëŸ¬ë‹ ë„ì…: ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ê°•í™”

ì „í†µì ì¸ ê¸°ìˆ ì  ì§€í‘œë§Œìœ¼ë¡œëŠ” ì‹œì¥ì˜ ë³µì¡í•œ íŒ¨í„´ì„ ëª¨ë‘ í¬ì°©í•˜ê¸° ì–´ë µë‹¤ëŠ” í•œê³„ë¥¼ ëŠê¼ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì„ ë„ì…í•˜ì—¬ ë§¤ë§¤ ì‹ í˜¸ì˜ ì •í™•ë„ë¥¼ ë†’ì´ê³ ì í–ˆìŠµë‹ˆë‹¤.

### ë¬¸ì œ ìƒí™©

- ì „í†µì  ê¸°ìˆ ì  ì§€í‘œëŠ” ì‹œì¥ ë³µì¡ì„± ëª¨ë‘ ìº¡ì²˜ ëª»í•¨
- ì—¬ëŸ¬ ì§€í‘œ ê°„ ê°€ì¤‘ì¹˜ ì„¤ì •ì´ ì£¼ê´€ì  íŒë‹¨ì— ì˜ì¡´
- ì‹œì¥ êµ­ë©´ ì „í™˜ ì‹œ ëŒ€ì‘ ë¶€ì¡±

### ê°œì„  ì‚¬í•­

#### 1. íŠ¹ì„± ì—”ì§€ë‹ˆì–´ë§

ì£¼ê°€ ë°ì´í„°ì—ì„œ ML ëª¨ë¸ì— ì‚¬ìš©í•  ë‹¤ì–‘í•œ íŠ¹ì„±(feature)ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤:

```python
def create_features(df, window_sizes=[5, 10, 20]):
    """ì‹œê³„ì—´ ë°ì´í„°ë¡œë¶€í„° ML íŠ¹ì„± ìƒì„±"""
    features = df.copy()
    
    # 1. ê¸°ìˆ ì  ì§€í‘œ ì¶”ê°€
    for size in window_sizes:
        features = calculate_moving_average(features, windows=[size])
    
    features = calculate_rsi(features)
    features = calculate_bollinger_bands(features)
    
    # 2. ê°€ê²© ë³€í™”ìœ¨
    features['price_change'] = features['stck_clpr'].pct_change()
    
    # 3. ì¶”ê°€ íŠ¹ì„±
    # ê±°ë˜ëŸ‰ íŠ¹ì„±
    features['volume_change'] = features['acml_vol'].pct_change()
    features['volume_ma'] = features['acml_vol'].rolling(window=10).mean()
    
    # ë³€ë™ì„± íŠ¹ì„±
    features['volatility'] = features['stck_clpr'].rolling(window=20).std()
    
    # 4. ì¶”ì„¸ ë ˆì´ë¸” (ìƒìŠ¹:1, í•˜ë½:-1, íš¡ë³´:0)
    features['target'] = np.where(features['price_change'] > 0.01, 1, 
                        np.where(features['price_change'] < -0.01, -1, 0))
    
    # ê²°ì¸¡ì¹˜ ì œê±°
    features = features.dropna()
    
    return features
```

#### 2. ëª¨ë¸ êµ¬í˜„

ëœë¤ í¬ë ˆìŠ¤íŠ¸ ë¶„ë¥˜ê¸°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì£¼ê°€ ì˜ˆì¸¡ ëª¨ë¸ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤:

```python
class StockPredictionModel:
    def __init__(self, model_path="models"):
        self.model_path = model_path
        self.model = None
        self._ensure_dir()
        
        # ëª¨ë¸ ë©”íƒ€ë°ì´í„°
        self.training_date = None
        self.accuracy = None
        self.f1_score = None
        self.feature_names = None
        self.feature_importances = None
        
    def train(self, X, y, feature_names=None):
        """ëª¨ë¸ í•™ìŠµ"""
        model = RandomForestClassifier(n_estimators=100, random_state=42)
        model.fit(X, y)
        self.model = model
        
        # í•™ìŠµ ë‚ ì§œ ê¸°ë¡
        self.training_date = datetime.now()
        
        # íŠ¹ì„± ì´ë¦„ ì €ì¥
        if feature_names is not None:
            self.feature_names = feature_names
        
        # íŠ¹ì„± ì¤‘ìš”ë„ ì €ì¥
        if hasattr(model, 'feature_importances_'):
            self.feature_importances = model.feature_importances_
        
        return model
```

#### 3. í†µí•© ì „ëµ í´ë˜ìŠ¤ ê°œë°œ

ê¸°ì¡´ íŠ¸ë ˆì´ë”© ì „ëµì— ML ëª¨ë¸ì„ í†µí•©í•œ ìƒˆë¡œìš´ ì „ëµ í´ë˜ìŠ¤ë¥¼ ê°œë°œí–ˆìŠµë‹ˆë‹¤:

```python
class IntegratedStrategy(BasicStrategy):
    """í†µí•© ì„ ë³„-ì§‘ì¤‘ ì „ëµ"""
    
    def __init__(self, market_data, order_api, config=None):
        super().__init__(market_data, order_api, config)
        
        # ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ ì´ˆê¸°í™”
        self.stock_model = None
        self.market_regime_model = None
        self._load_models()
        
        # ì‹œì¥ êµ­ë©´ ë° ìŠ¤ì½”ì–´ ìºì‹œ
        self.market_regime = 'neutral'
        self.stock_scores = {}
        
    def _calculate_stock_score(self, stock_code):
        """ì¢…ëª©ë³„ ì¢…í•© ì ìˆ˜ ê³„ì‚°"""
        try:
            # ê¸°ë³¸ ë°ì´í„° ë¡œë“œ
            df = self.market_data.get_stock_daily_price(stock_code, period=60)
            
            # 1. ëª¨ë©˜í…€ ì ìˆ˜ (20ì¼ ìˆ˜ìµë¥ )
            # ... ì½”ë“œ ìƒëµ ...
            
            # 2. ê¸°ìˆ ì  ì§€í‘œ ê³„ì‚°
            analysis = self.analyze_stock(stock_code)
            
            # 3. ML ì˜ˆì¸¡ ì ìˆ˜
            ml_score = 0
            if self.stock_model:
                try:
                    # íŠ¹ì„± ìƒì„±
                    features = create_features(df).iloc[0]
                    # ML ì˜ˆì¸¡ (0: í•˜ë½, 1: íš¡ë³´, 2: ìƒìŠ¹)
                    prediction = self.stock_model.predict_proba([features])
                    # ìƒìŠ¹ í™•ë¥ ì—ì„œ í•˜ë½ í™•ë¥ ì„ ëº€ ê°’ (-1 ~ 1)
                    ml_score = prediction[0][2] - prediction[0][0]
                except:
                    pass
            
            # ì¢…í•© ì ìˆ˜ ê³„ì‚° (ê° ì ìˆ˜ì˜ ê°€ì¤‘ í‰ê· )
            weights = {
                'momentum': 0.35,
                'technical': 0.35,
                'ml': 0.30
            }
            
            total_score = (
                weights['momentum'] * momentum_score +
                weights['technical'] * technical_score +
                weights['ml'] * ml_score
            )
            
            return total_score
            
        except Exception as e:
            logger.error(f"{stock_code} ì ìˆ˜ ê³„ì‚° ì¤‘ ì˜¤ë¥˜: {str(e)}")
            return 0
```

#### 4. ì‹œì¥ êµ­ë©´ ì˜ˆì¸¡ ê¸°ëŠ¥ ì¶”ê°€

ì „ì²´ ì‹œì¥ ìƒí™©ì— ë”°ë¼ ë§¤ë§¤ ì „ëµì„ ìë™ìœ¼ë¡œ ì¡°ì •í•˜ëŠ” ì‹œì¥ êµ­ë©´ ì˜ˆì¸¡ ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤:

```python
def update_market_regime(self):
    """ì‹œì¥ êµ­ë©´ ì—…ë°ì´íŠ¸"""
    try:
        # KOSPI ì§€ìˆ˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        kospi_data = self.market_data.get_stock_daily_price('KOSPI', period=60)
        
        # íŠ¹ì„± ìƒì„±
        features = create_features(kospi_data).iloc[0]
        
        # ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ë¡œ êµ­ë©´ ì˜ˆì¸¡
        if self.market_regime_model:
            # ëª¨ë¸ ì˜ˆì¸¡ (0: ì•½ì„¸, 1: ì¤‘ë¦½, 2: ê°•ì„¸)
            prediction = self.market_regime_model.predict([features])[0]
            
            if prediction == 0:
                self.market_regime = 'bearish'
            elif prediction == 2:
                self.market_regime = 'bullish'
            else:
                self.market_regime = 'neutral'
        
        # ì‹œì¥ êµ­ë©´ì— ë”°ë¼ ì „ëµ íŒŒë¼ë¯¸í„° ì¡°ì •
        self._adjust_parameters_by_regime()
        
        return self.market_regime
    except Exception as e:
        logger.error(f"ì‹œì¥ êµ­ë©´ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜: {str(e)}")
        return 'neutral'

def _adjust_parameters_by_regime(self):
    """ì‹œì¥ êµ­ë©´ì— ë”°ë¼ íŒŒë¼ë¯¸í„° ì¡°ì •"""
    if self.market_regime == 'bullish':
        # ê°•ì„¸ì¥ íŒŒë¼ë¯¸í„° - ê³µê²©ì  íˆ¬ì
        self.config['stop_loss'] = 0.05
        self.config['take_profit'] = 0.08
        self.config['position_size'] = 0.20
        self.config['max_position'] = 10
    elif self.market_regime == 'bearish':
        # ì•½ì„¸ì¥ íŒŒë¼ë¯¸í„° - ë³´ìˆ˜ì  íˆ¬ì
        self.config['stop_loss'] = 0.03
        self.config['take_profit'] = 0.05
        self.config['position_size'] = 0.10
        self.config['max_position'] = 3
    else:
        # ì¤‘ë¦½ íŒŒë¼ë¯¸í„°
        self.config['stop_loss'] = 0.04
        self.config['take_profit'] = 0.06
        self.config['position_size'] = 0.15
        self.config['max_position'] = 4
```

ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ ë„ì…ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì´ì ì„ ì–»ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤:

1. **ì¢…ëª© ì„ ì • ì •í™•ë„ í–¥ìƒ**: ê¸°ìˆ ì  ì§€í‘œ, ëª¨ë©˜í…€, ML ì˜ˆì¸¡ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•˜ì—¬ ë” ì •í™•í•œ ì¢…ëª© ì„ ì • ê°€ëŠ¥
2. **ì‹œì¥ êµ­ë©´ ì ì‘**: ì‹œì¥ ìƒí™©ì— ë”°ë¼ ìë™ìœ¼ë¡œ ë§¤ë§¤ íŒŒë¼ë¯¸í„° ì¡°ì •
3. **ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì •**: ì£¼ê´€ì  íŒë‹¨ ëŒ€ì‹  ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì •ìœ¼ë¡œ ê°ì •ì  í¸í–¥ ì œê±°

ì‹œìŠ¤í…œ ë‚´ì—ì„œ ML ëª¨ë¸ì€ ì£¼ë¡œ ìƒìŠ¹/í•˜ë½/íš¡ë³´ í™•ë¥ ì„ ì˜ˆì¸¡í•˜ëŠ”ë°, ì˜ˆì¸¡ëœ í™•ë¥ ì„ ë°”íƒ•ìœ¼ë¡œ ê¸°ì¡´ ê¸°ìˆ ì  ì§€í‘œì™€ í•¨ê»˜ ê°€ì¤‘ í‰ê· í•˜ì—¬ ìµœì¢… ë§¤ë§¤ ì‹ í˜¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. íŠ¹íˆ ì£¼ëª©í•  ì ì€ ML ëª¨ë¸ì´ ê³¼ê±°ì— íš¨ê³¼ì ì´ì—ˆë˜ ë§¤ë§¤ íŒ¨í„´ì„ í•™ìŠµí•˜ì—¬ ì‹œì¥ ìƒí™©ì— ì ì‘í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

## ê²°ë¡  ë° ì¶”í›„ ê°œì„  ë°©í–¥

ì§€ê¸ˆê¹Œì§€ í•œêµ­íˆ¬ìì¦ê¶Œ APIë¥¼ í™œìš©í•œ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œì˜ ì£¼ìš” ê°œì„  ì‚¬í•­ì— ëŒ€í•´ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤:

1. **ë¡œê¹… ì‹œìŠ¤í…œ ê°•í™”**: ì‹œìŠ¤í…œ íˆ¬ëª…ì„± í–¥ìƒ ë° ë””ë²„ê¹… íš¨ìœ¨í™”
2. **ë‹¨ê¸° ë§¤ë§¤ ì „ëµ ë„ì…**: ì¥ì¤‘ ë³€ë™ì„± í™œìš© ë° ì˜¤ë²„ë‚˜ì‡ ë¦¬ìŠ¤í¬ ì œê±°
3. **ë¨¸ì‹ ëŸ¬ë‹ ì ìš©**: ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ë° ì‹œì¥ ì ì‘ë ¥ í–¥ìƒ

ì´ëŸ¬í•œ ê°œì„  ì‚¬í•­ë“¤ì€ ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ê³¼ ì•ˆì •ì„±ì„ í¬ê²Œ í–¥ìƒì‹œì¼°ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì—¬ì „íˆ ë‹¤ìŒê³¼ ê°™ì€ ê°œì„  ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤:

- **ì‹¤ì‹œê°„ ì›¹ì†Œì¼“ í™œìš©**: í˜„ì¬ëŠ” ì£¼ê¸°ì  API í˜¸ì¶œë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì§€ë§Œ, ì›¹ì†Œì¼“ì„ í†µí•œ ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹ ìœ¼ë¡œ ê°œì„  ê°€ëŠ¥
- **ë¶„ì‚° íˆ¬ì ìµœì í™”**: ì¢…ëª© ê°„ ìƒê´€ê´€ê³„ë¥¼ ê³ ë ¤í•œ í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„± ê¸°ëŠ¥ ì¶”ê°€
- **API ì˜¤ë¥˜ ë³µì›ë ¥ ê°•í™”**: API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„ ë° ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ ê°•í™”

ìë™ë§¤ë§¤ ì‹œìŠ¤í…œ ê°œë°œì€ ì§€ì†ì ì¸ ê°œì„ ê³¼ í•™ìŠµì˜ ê³¼ì •ì…ë‹ˆë‹¤. ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì›¹ ëŒ€ì‹œë³´ë“œ ê°œë°œê³¼ ì¥ê¸° ë°±í…ŒìŠ¤íŒ… ê²°ê³¼ì— ëŒ€í•´ ë‹¤ë£¨ì–´ ë³´ê² ìŠµë‹ˆë‹¤.

í”„ë¡œê·¸ë˜ë° ê¸°ìˆ ì„ í™œìš©í•œ íˆ¬ì ìë™í™”, ì¬ë¯¸ìˆê³  ìœ ìµí•œ ì—¬ì •ì´ ë˜ê¸¸ ë°”ëë‹ˆë‹¤! ì§ˆë¬¸ì´ë‚˜ ì˜ê²¬ì€ ì–¸ì œë“ ì§€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”. ğŸ˜Š

---

#### ì½”ë“œ ì €ì¥ì†Œ

ì´ í”„ë¡œì íŠ¸ì˜ ì „ì²´ ì†ŒìŠ¤ ì½”ë“œëŠ” [GitHub ì €ì¥ì†Œ](https://github.com/tgparkk/autoStockTrading)ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.